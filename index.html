<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Vocab Ultra</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:#f3f5f9}

header{position:sticky;top:0;background:#fff;padding:14px;
box-shadow:0 2px 6px rgba(0,0,0,.08);z-index:10}

h1{margin:0;font-size:22px}
.count{font-size:13px;color:#666;margin-top:2px}

.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
button{border:none;border-radius:10px;padding:10px 12px;font-size:14px}

.import{background:#1e88e5;color:#fff}
.export{background:#6a5acd;color:#fff}
.deleteall{background:#e53935;color:#fff}
.favbtn{background:#f39c12;color:#fff}
.refresh{background:#27ae60;color:#fff}
.add{background:#e3f2fd}
.check{background:#8e44ad;color:#fff}

.search{
margin-top:10px;width:100%;padding:12px;border-radius:12px;
border:1px solid #ccc;font-size:16px
}

main{padding:14px}

.card{
background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;
position:relative
}

.word{font-weight:700;font-size:18px}
.pron{color:#666;margin-top:2px;word-break:break-word}
.meaning{margin-top:2px;word-break:break-word}

.icons{margin-top:6px}
.icons span{font-size:20px;margin-right:8px}

.star{
position:absolute;right:12px;top:12px;font-size:22px;cursor:pointer
}

.modal{
position:fixed;inset:0;background:rgba(0,0,0,.35);
display:none;align-items:center;justify-content:center;
padding:14px;z-index:99
}

.modal-content{
background:#fff;border-radius:16px;padding:14px;width:100%;
max-width:420px;max-height:90vh;overflow:auto
}

.modal-content input,
.modal-content textarea{
width:100%;margin-bottom:10px;padding:12px 14px;
border-radius:10px;border:1px solid #ccc;font-size:16px;
white-space:pre-wrap;word-break:break-word;
}

.modal-actions{display:flex;gap:10px;margin-top:6px}
.modal-actions button{flex:1}

.audio{background:#2ecc71;color:#fff}
.save{background:#1e88e5;color:#fff}
.delete{background:#e53935;color:#fff}
.cancel{background:#bbb}

.result{text-align:center;font-size:18px;margin-top:6px;font-weight:700}
.correct{color:#27ae60}
.wrong{color:#e74c3c}

.score{margin-top:4px;color:#555}

.closeX{
position:absolute;right:14px;top:10px;font-size:22px;cursor:pointer
}
</style>
</head>

<body>

<header>
<h1>üìò My Vocab Ultra</h1>
<div class="count" id="count">Total vocabulary: 0</div>

<div class="controls">
<button class="import" onclick="importCSV()">üì•</button>
<button class="export" onclick="exportCSV()">üì§</button>
<button class="deleteall" onclick="deleteAll()">üß®</button>
<button class="favbtn" onclick="toggleFavView()">‚≠ê</button>
<button class="refresh" onclick="resetView()">üîÑ</button>
<button class="check" onclick="openChecker()">üé§ Check</button>
</div>

<input class="search" id="search" placeholder="Search..." oninput="render()">
</header>

<main id="list"></main>

<!-- CHECKER -->
<div class="modal" id="checkerModal">
<div class="modal-content">

<div class="closeX" onclick="closeChecker()">‚úñ</div>

<input id="checkInput" placeholder="Type any word..."
onkeydown="if(event.key==='Enter')loadCheckWord()">

<div id="checkWord" class="word"></div>
<div id="checkIPA" class="pron"></div>

<div class="modal-actions">
<button class="audio" onclick="hearWord()">üîä Hear</button>
<button class="audio" onclick="testWord()">üé§ Test</button>
</div>

<div id="checkResult" class="result"></div>
<div id="checkScore" class="score"></div>

</div>
</div>

<script>
let data=JSON.parse(localStorage.getItem("vocab")||"[]")
let favOnly=false
let currentCheckWord=""
let totalAttempts=0
let correctAttempts=0

function render(){
const list=document.getElementById("list")
const q=document.getElementById("search").value.toLowerCase()
list.innerHTML=""

let arr=data.filter(v=>{
if(favOnly && !v.fav) return false
return v.word.toLowerCase().includes(q) ||
(v.meaning||"").toLowerCase().includes(q)
})

document.getElementById("count").innerText=`Total vocabulary: ${data.length}`

arr.forEach(v=>{
const i=data.indexOf(v)
const d=document.createElement("div")
d.className="card"
d.innerHTML=`
<div class="word">${v.word}</div>
<div class="pron">${v.pron||""}</div>
<div class="meaning">${v.meaning||""}</div>
<div class="icons">
<span onclick="speak('${v.word}')">üîä</span>
<span onclick="speakSlow('${v.word}')">üê¢</span>
</div>
<div class="star" onclick="toggleFav(${i})">${v.fav?"‚≠ê":"‚òÜ"}</div>
`
list.appendChild(d)
})
}

function toggleFav(i){data[i].fav=!data[i].fav;render()}
function toggleFavView(){favOnly=!favOnly;render()}
function resetView(){favOnly=false;search.value="";render()}

function speak(t){speechSynthesis.speak(new SpeechSynthesisUtterance(t))}
function speakSlow(t){let u=new SpeechSynthesisUtterance(t);u.rate=0.6;speechSynthesis.speak(u)}

function deleteAll(){
if(confirm("Delete all?")){data=[];render()}
}

/* CHECKER */
function openChecker(){
checkerModal.style.display="flex"
checkInput.focus()
}

function closeChecker(){
checkerModal.style.display="none"
checkInput.value=""
checkWord.innerText=""
checkIPA.innerText=""
checkResult.innerText=""
checkScore.innerText=""
}

async function loadCheckWord(){
currentCheckWord=checkInput.value.trim().toLowerCase()
if(!currentCheckWord)return
checkWord.innerText=currentCheckWord
checkResult.innerText=""
checkScore.innerText=""
fetchIPA(currentCheckWord)
}

async function fetchIPA(word){
try{
let res=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`)
let data=await res.json()
let ipa=data[0]?.phonetics?.find(p=>p.text)?.text || ""
checkIPA.innerText=ipa
}catch{
checkIPA.innerText=""
}
}

function hearWord(){
if(!currentCheckWord)return
speak(currentCheckWord)
}

function testWord(){
if(!currentCheckWord)return

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition
if(!SpeechRecognition){alert("Speech not supported");return}

const rec=new SpeechRecognition()
rec.lang="en-US"
rec.start()

rec.onresult=e=>{
const spoken=e.results[0][0].transcript.toLowerCase()
totalAttempts++

if(spoken.includes(currentCheckWord)){
correctAttempts++
checkResult.innerHTML="‚úî Correct"
checkResult.className="result correct"
playCling()
}else{
checkResult.innerHTML="‚úñ Try again"
checkResult.className="result wrong"
playBeep()
hearWord()
}

updateScore()
}
}

function updateScore(){
let score=Math.round((correctAttempts/totalAttempts)*100)
checkScore.innerText=`Score: ${score}% (${correctAttempts}/${totalAttempts})`
}

function playCling(){
new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg").play()
}
function playBeep(){
new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play()
}

/* CSV */
function exportCSV(){
let csv="word,pronunciation,meaning,fav\n"
data.forEach(v=>{
csv+=`"${v.word}","${v.pron}","${v.meaning}","${v.fav?1:0}"\n`
})
const a=document.createElement("a")
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}))
a.download="vocab.csv"
a.click()
}

function importCSV(){
const i=document.createElement("input")
i.type="file";i.accept=".csv"
i.onchange=e=>{
const r=new FileReader()
r.onload=()=>{
const lines=r.result.split(/\r?\n/).slice(1)
data=[]
lines.forEach(l=>{
if(!l.trim())return
const c=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
if(!c)return
data.push({
word:c[0].replace(/"/g,""),
pron:c[1].replace(/"/g,""),
meaning:c[2].replace(/"/g,""),
fav:c[3]=="1"
})
})
render()
alert("Import success")
}
r.readAsText(e.target.files[0])
}
i.click()
}

render()
</script>
</body>
</html>
